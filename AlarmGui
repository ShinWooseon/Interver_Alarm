import javax.swing.*;
import java.awt.event.*;
import java.util.Timer;
import java.util.TimerTask;

public class AlarmGui {
    private static Timer alarmTimer;
    private static Timer restartTimer;
    private static javax.swing.Timer countdownTimer;
    private static javax.swing.Timer restartCountdownTimer;
    private static boolean isRunning = false;
    private static int remainingAlarmTime;
    private static int remainingRestartTime;

    public static void main(String[] args) {
        JFrame frame = new JFrame("â° ì¸í„°ë²Œ ì•ŒëŒ");
        JTextField intervalField = new JTextField(5);
        JTextField restartField = new JTextField(5);
        JLabel intervalLabel = new JLabel("ì•ŒëŒ ì£¼ê¸° (ì´ˆ):");
        JLabel restartLabel = new JLabel("ì¬ì‹œì‘ ê°„ê²© (ì´ˆ):");
        JLabel alarmCountdown = new JLabel("ì•ŒëŒê¹Œì§€ ë‚¨ì€ ì‹œê°„: -- ì´ˆ");
        JLabel restartCountdown = new JLabel("ì¬ì‹œì‘ê¹Œì§€ ë‚¨ì€ ì‹œê°„: -- ì´ˆ");
        JButton startButton = new JButton("ì•ŒëŒ ì‹œì‘");
        JButton stopButton = new JButton("ì•ŒëŒ ì •ì§€");

        JPanel panel = new JPanel();
        panel.add(intervalLabel);
        panel.add(intervalField);
        panel.add(restartLabel);
        panel.add(restartField);
        panel.add(startButton);
        panel.add(stopButton);
        panel.add(alarmCountdown);
        panel.add(restartCountdown);
        frame.add(panel);

        frame.setSize(200, 180);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setVisible(true);

        startButton.addActionListener(e -> {
            try {
                int interval = Integer.parseInt(intervalField.getText());
                int restart = Integer.parseInt(restartField.getText());
                isRunning = true;
                startButton.setEnabled(false);
                startAlarm(frame, interval, restart, alarmCountdown, restartCountdown, startButton);
            } catch (NumberFormatException ex) {
                JOptionPane.showMessageDialog(frame, "ìˆ«ìë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            }
        });

        stopButton.addActionListener(e -> {
            isRunning = false;
            if (alarmTimer != null) alarmTimer.cancel();
            if (restartTimer != null) restartTimer.cancel();
            if (countdownTimer != null) countdownTimer.stop();
            if (restartCountdownTimer != null) restartCountdownTimer.stop();
            alarmCountdown.setText("ì•ŒëŒê¹Œì§€ ë‚¨ì€ ì‹œê°„: -- ì´ˆ");
            restartCountdown.setText("ì¬ì‹œì‘ê¹Œì§€ ë‚¨ì€ ì‹œê°„: -- ì´ˆ");
            startButton.setEnabled(true);
        });
    }

    private static void startAlarm(JFrame frame, int interval, int restart,
                                   JLabel alarmLabel, JLabel restartLabel, JButton startButton) {
        remainingAlarmTime = interval;
        countdownTimer = new javax.swing.Timer(1000, null);
        countdownTimer.addActionListener(e -> {
            alarmLabel.setText("ì•ŒëŒê¹Œì§€ ë‚¨ì€ ì‹œê°„: " + remainingAlarmTime + " ì´ˆ");
            remainingAlarmTime--;
        });
        countdownTimer.start();

        alarmTimer = new Timer();
        alarmTimer.schedule(new TimerTask() {
            public void run() {
                countdownTimer.stop();
                alarmLabel.setText("âœ… ì•ŒëŒ ìš¸ë¦¼!");
                SwingUtilities.invokeLater(() -> {
                    JDialog dialog = new JDialog();
                    dialog.setAlwaysOnTop(true);
                    JOptionPane.showMessageDialog(dialog, "ğŸ”” ì•ŒëŒ ìš¸ë¦¼! (6m ì „ë°©ì„ ì‘ì‹œí•˜ì„¸ìš”.)\n ğŸ”” " + interval + "ì´ˆ í›„ ì•ŒëŒ ì¬ì‹œì‘");
                    dialog.dispose();
                    
                });

                alarmTimer.cancel();

                if (isRunning) {
                    startRestartCountdown(frame, interval, restart, alarmLabel, restartLabel, startButton);
                } else {
                    startButton.setEnabled(true);
                }
            }
        }, interval * 1000);
    }

    private static void startRestartCountdown(JFrame frame, int interval, int restart,
                                              JLabel alarmLabel, JLabel restartLabel, JButton startButton) {
        remainingRestartTime = restart;
        restartCountdownTimer = new javax.swing.Timer(1000, null);
        restartCountdownTimer.addActionListener(e -> {
            restartLabel.setText("ì¬ì‹œì‘ê¹Œì§€ ë‚¨ì€ ì‹œê°„: " + remainingRestartTime + " ì´ˆ");
            remainingRestartTime--;
        });
        restartCountdownTimer.start();

        restartTimer = new Timer();
        restartTimer.schedule(new TimerTask() {
            public void run() {
                restartCountdownTimer.stop();
                restartLabel.setText("ì¬ì‹œì‘ ì¤‘...");
                startAlarm(frame, interval, restart, alarmLabel, restartLabel, startButton);
                JDialog dialog = new JDialog();
                dialog.setAlwaysOnTop(true);
                JOptionPane.showMessageDialog(dialog, "ğŸ”” ì¬ì‹œì‘");
                dialog.dispose();
            }
        }, restart * 1000);
    }
}
